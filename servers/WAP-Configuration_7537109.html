<!--
title: WAP Configuration
description: 
published: true
date: 2022-04-21T13:08:02.953Z
tags: 
editor: ckeditor
dateCreated: 2022-04-21T13:08:00.981Z
-->

                    <p>The current version of WAP cannot be configured through the GUI, so cmdlets must be used to edit, otherwise just destroy and rebuild the rule if possible.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/7537109/7537108.png" data-image-src="attachments/7537109/7537108.png" data-unresolved-comment-count="0" data-linked-resource-id="7537108" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screen Shot 2016-05-24 at 8.34.33 AM.png" data-base-url="https://docs.intranet.southern.edu:8443" data-linked-resource-content-type="image/png" data-linked-resource-container-id="7537109" data-linked-resource-container-version="10"></span></p><h4 id="WAPConfiguration-PublishingRules">Publishing Rules</h4><p>Follow the existing rules as examples on how to publish a rule. keep in mind that the front end url has to always be HTTPS, that the url/domain cannot collide (eg deploying a root / and subdirectory rule).</p><p>During the publish wizard, select &quot;MyAccess Non-Claims Aware&quot; as a relying party</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/7537109/7537169.png" data-image-src="attachments/7537109/7537169.png" data-unresolved-comment-count="0" data-linked-resource-id="7537169" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screen Shot 2016-05-25 at 1.22.36 PM.png" data-base-url="https://docs.intranet.southern.edu:8443" data-linked-resource-content-type="image/png" data-linked-resource-container-id="7537109" data-linked-resource-container-version="10"></span></p><p>On the last page, ensure you have entered the correct SPN record for the backend web server.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/7537109/7537170.png" data-image-src="attachments/7537109/7537170.png" data-unresolved-comment-count="0" data-linked-resource-id="7537170" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screen Shot 2016-05-25 at 1.23.14 PM.png" data-base-url="https://docs.intranet.southern.edu:8443" data-linked-resource-content-type="image/png" data-linked-resource-container-id="7537109" data-linked-resource-container-version="10"></span></p><p>To make the kerberos delegation work, ensure that the WAP computer objects (Minerva/Murray) are allowed to delegate the SPN (from dorel/peugeot)</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/7537109/7537172.png" data-image-src="attachments/7537109/7537172.png" data-unresolved-comment-count="0" data-linked-resource-id="7537172" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screen Shot 2016-05-25 at 1.37.10 PM.png" data-base-url="https://docs.intranet.southern.edu:8443" data-linked-resource-content-type="image/png" data-linked-resource-container-id="7537109" data-linked-resource-container-version="10"></span></p><p>Then ensure that the backend web server accepts kerberos authentication</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/7537109/7537174.png" data-image-src="attachments/7537109/7537174.png" data-unresolved-comment-count="0" data-linked-resource-id="7537174" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screen Shot 2016-05-25 at 1.39.08 PM.png" data-base-url="https://docs.intranet.southern.edu:8443" data-linked-resource-content-type="image/png" data-linked-resource-container-id="7537109" data-linked-resource-container-version="10"></span></p><p><strong>Note</strong>: If the backend server is using a service account, like sharepoint does, you must ensure the service account has an SPN record defined in the account (use ADSI Edit), and point to that SPN instead of using HOST/backendservername.</p><h4 id="WAPConfiguration-QuickCommands">Quick Commands</h4><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col><col></colgroup><tbody><tr><th class="confluenceTh">Command</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">Get-WebApplicationProxyApplication | Format-List</td><td class="confluenceTd">Show the WAP rules and their configuration values</td></tr></tbody></table></div><h4 id="WAPConfiguration-Troubleshootingdangers">Troubleshooting dangers</h4><p>During SSL certificate expiry from ADFS, we had to go through some hoops in ADFS AND WAP to get it to work, because WAP (via powershell) stores the certificate thumbprint from ADFS, so this must be updated to work.</p><p><strong>Change the certificates thumbprint  (example)</strong></p><p>‎Set-WebApplicationProxyApplication -ID 445b969e-0583-b74d-9343-ee2e0c036f49 -ExternalCertificateThumbprint 9b86296d606e012076d641bf8f8bd61bffaaea22</p><h4 id="WAPConfiguration-Changingthecertificatethumbprintforlogin.southern.edu">Changing the certificate thumbprint for login.southern.edu</h4><p>Set-WebApplicationProxySslCertificate 7A7E555D8159090E53E08DEAB1065C094D9B1135</p><p><br></p><p><br></p>
                    